<!doctype html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <title>Split Modal Dialog Example</title>

  <!-- jQuery and jQuery modal -->
  <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>   
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />
  <style>
    .modal {
      padding: 0;
    }
    .modal a.close-modal {
      display: none;
    }
    img {
      max-width: 100%;
    }
  </style>
  <script src="https://cdn.split.io/sdk/split-10.22.4.min.js"></script>    
  <script>  
    var factory = splitio({
      core: {
        authorizationKey: '$$SPLIT_CLIENT_API_KEY$$',
        key: 'user_id' // unique identifier for your user
      },
      scheduler: {
        eventsPushRate: 5
      }
    });

    var client = factory.client();

    client.on(client.Event.SDK_READY, function() {
      updateModal();      
    });    

    client.on(client.Event.SDK_UPDATE, function() {
      updateModal();
    })

    let startTimeInMillis = 0;
    function updateModal() {
      startTimeInMillis = new Date().getTime();

      var splitResult = client.getTreatmentWithConfig('modal_madness');
      var configs = JSON.parse(splitResult.config);
      console.log(configs);
      document.getElementById('photo').src = configs.imgSrc;
      document.getElementById('title').innerHTML = configs.title;
      document.getElementById('copy').innerHTML = configs.copy;
    }

    function handleClick() {
      const props = {
        region: 'NA',
        status: 'platinum'
      }

      let queued = client.track("user", "click.learn_more", Math.floor(Math.random() * 100), props);
      console.log('queued? ' + queued);
      queued = client.track("user", "think_time.learn_more", (new Date().getTime() - startTimeInMillis), props);
      console.log('queued? ' + queued);      
    }
  </script>
</head>
<body>
  <div class="grid h-screen place-items-center">
    <div class="place-self-center">
      <a href="#myModal" rel="modal:open" class="bg-purple-600 hover:bg-purple-800 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mt-5 place-items-center">Open Modal</a>
    </div>
  </div>
  <div id="myModal" class="modal" role="dialog" aria-modal="true">
    <div class="modal-content">
      <div class="relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all ">
        <div>
          <img id="photo"/>
          <div class="mt-3 text-center sm:mt-5">
            <h3 class="text-base font-semibold leading-6 text-gray-900" id="title">â€¦</h3>
            <div class="mt-2">
              <p id="copy" class="text-sm text-gray-500">Lorem ipsum, dolor sit amet consectetur adipisicing elit. Eius aliquam laudantium explicabo pariatur iste dolorem animi vitae error totam. At sapiente aliquam accusamus facere veritatis.</p>
            </div>
          </div>
        </div>
        <div class="mt-5 sm:mt-6 sm:grid sm:grid-flow-row-dense sm:grid-cols-2 sm:gap-3">
          <button type="button" class="inline-flex w-full justify-center rounded-md bg-purple-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-purple-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-purple-600 sm:col-start-2">Learn more</button>
          <a href="#" rel="modal:close" class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:col-start-1 sm:mt-0">Close</a>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
